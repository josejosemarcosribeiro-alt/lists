extends layout

block content
    br
    h3 Edit Aula

    form(method="POST", action="/list/edit/" + item._id, enctype="multipart/form-data")
        #form-group
            label Title:
            input.form-control(name="title", type="text", value=item.title, required)

        #form-group
            label Current Aula:
            if item.videoPath
                video(width="320", height="240", controls)
                    source(src=item.videoPath, type="video/mp4")
                br
                form(method="POST", action="/list/delete-video/" + item._id)
                    input.btn.btn-danger(type="submit", value="Delete Video")
            else
                p No aula uploaded yet.

        #form-group
            label Upload New Aula (optional):
            input(type="hidden", name="video", id="videoInput")
            button.btn.btn-secondary(type="button", id="uploadButton") Upload New Video

        #form-group
            label Description (optional):
            textarea.form-control(name="body", rows="10")= item.body

        br
        input.btn.btn-primary.float-right(type="submit", value="Save")

    if errors
        ul.text-danger
            each err in errors
                li= err.msg
    if success
        p.text-success= success

    //- Cloudinary Upload Widget
    script.
        const myWidget = cloudinary.createUploadWidget({
            cloudName: 'SEU_CLOUD_NAME',
            uploadPreset: 'SEU_UPLOAD_PRESET',
            multiple: false,
            resourceType: 'video',
            clientAllowedFormats: ['mp4', 'mov', 'avi']
        }, (error, result) => {
            if (!error && result && result.event === "success") {
                console.log('Upload realizado:', result.info.secure_url);
                document.getElementById('videoInput').value = result.info.secure_url;
            }
        });

        document.getElementById("uploadButton").addEventListener("click", () => {
            myWidget.open();
        });
